<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Can It Actually Run?</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Marked for Markdown parsing in AI response -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg-beige: #F5F5DC;
            --card-white: #FFFFFF;
            --text-pixel: #3d3d3d;
            --accent-green: #70AA5D; /* Minecraft grass green-ish */
            --accent-red: #C44E4E;
            --pixel-border: 4px solid #3d3d3d;
        }

        body {
            background-color: var(--bg-beige);
            font-family: 'VT323', monospace;
            color: var(--text-pixel);
            background-image: radial-gradient(#d8d8c0 1px, transparent 1px);
            background-size: 20px 20px;
        }

        .pixel-box {
            background-color: var(--card-white);
            border: var(--pixel-border);
            box-shadow: 6px 6px 0px rgba(0,0,0,0.1);
            transition: transform 0.1s;
        }

        .pixel-input {
            border: 2px solid #3d3d3d;
            font-family: 'VT323', monospace;
            font-size: 1.25rem;
            outline: none;
        }

        .pixel-input:focus {
            border-color: var(--accent-green);
            box-shadow: 2px 2px 0px var(--accent-green);
        }

        .pixel-btn {
            background-color: #e0e0e0;
            border: 2px solid #3d3d3d;
            cursor: pointer;
            text-transform: uppercase;
            font-weight: bold;
            font-size: 1.25rem;
            transition: all 0.1s;
        }

        .pixel-btn:hover {
            background-color: #d0d0d0;
            transform: translateY(-2px);
            box-shadow: 0 2px 0 #3d3d3d;
        }

        .pixel-btn:active {
            transform: translateY(0);
            box-shadow: none;
        }

        .pixel-btn.primary {
            background-color: var(--accent-green);
            color: white;
            text-shadow: 2px 2px 0px rgba(0,0,0,0.2);
        }
        
        .pixel-btn.primary:hover {
            background-color: #5e914d;
        }

        /* Loading Animation */
        @keyframes scan {
            0% { background-position: 0% 0%; }
            100% { background-position: 0% 100%; }
        }

        .scanning {
            background: linear-gradient(to bottom, transparent 50%, rgba(112, 170, 93, 0.2) 51%, transparent 52%);
            background-size: 100% 10px;
            animation: scan 1s linear infinite;
        }

        /* Markdown Styles within the pixel look */
        .prose p { margin-bottom: 0.5rem; }
        .prose strong { color: #000; }
        
        .hidden { display: none; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4 md:p-8">

    <!-- API Key Modal (Initially Hidden) -->
    <div id="apiKeyModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="pixel-box p-6 w-full max-w-md relative">
            <h2 class="text-2xl font-bold mb-4">SYSTEM SETTINGS</h2>
            <p class="mb-4">Enter Gemini API Key to enable AI analysis.</p>
            <input type="password" id="apiKeyInput" placeholder="Paste API Key here..." class="pixel-input w-full p-2 mb-4">
            <div class="flex justify-end gap-2">
                <button onclick="closeModal()" class="pixel-btn px-4 py-2">CANCEL</button>
                <button onclick="saveKey()" class="pixel-btn primary px-4 py-2">SAVE KEY</button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="mb-8 text-center relative w-full max-w-4xl">
        <h1 class="text-6xl md:text-7xl font-bold tracking-wider mb-2" style="text-shadow: 4px 4px 0px #cfcfb4;">CAN IT RUN?</h1>
        <p class="text-2xl text-gray-600">The "Real World" AI Performance Checker</p>
        
        <button onclick="openModal()" class="absolute top-0 right-0 pixel-btn px-3 py-1 text-sm">
            ⚙️ KEY
        </button>
    </header>

    <main class="w-full max-w-4xl grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <!-- Input Section -->
        <section class="lg:col-span-2 flex flex-col gap-6">
            
            <!-- Hardware Specs -->
            <div class="pixel-box p-6 relative">
                <div class="absolute -top-4 left-4 bg-white px-2 border-2 border-gray-800 text-xl font-bold">YOUR RIG</div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                    <div class="flex flex-col">
                        <label class="text-xl mb-1">CPU (Processor)</label>
                        <select id="cpuSelect" class="pixel-input p-2 w-full bg-white">
                            <option value="Intel Core i3 7th Gen / Ryzen 3 1200">Intel Core i3 / Ryzen 3 (Older)</option>
                            <option value="Intel Core i5 9th Gen / Ryzen 5 3600">Intel Core i5 / Ryzen 5 (Mid-Range)</option>
                            <option value="Intel Core i5 13600K / Ryzen 5 7600">Intel Core i5 / Ryzen 5 (Modern)</option>
                            <option value="Intel Core i7 12700K / Ryzen 7 5800X">Intel Core i7/i9 / Ryzen 7/9</option>
                            <option value="Intel Celeron / Pentium">Potato (Celeron/Pentium)</option>
                        </select>
                    </div>

                    <div class="flex flex-col">
                        <label class="text-xl mb-1">RAM (Memory)</label>
                        <select id="ramSelect" class="pixel-input p-2 w-full bg-white">
                            <option value="4GB Single Channel">4 GB</option>
                            <option value="8GB Single Channel">8 GB (Single Channel)</option>
                            <option value="8GB Dual Channel">8 GB (Dual Channel)</option>
                            <option value="16GB Dual Channel" selected>16 GB</option>
                            <option value="32GB+">32 GB+</option>
                        </select>
                    </div>

                    <div class="flex flex-col md:col-span-2">
                        <label class="text-xl mb-1">GPU (Graphics Card)</label>
                        <select id="gpuSelect" class="pixel-input p-2 w-full bg-white">
                            <option value="Intel UHD 620 / HD Graphics">Intel HD Graphics / UHD 620 (Office Laptop)</option>
                            <option value="AMD Vega 8 / Intel Iris Xe">AMD Vega 8 / Intel Iris Xe (Good Integrated)</option>
                            <option value="NVIDIA GTX 1050 / RX 560">GTX 1050 / GTX 1650 / RX 560</option>
                            <option value="NVIDIA RTX 3050 / RTX 2060">RTX 3050 / RTX 2060 / RX 6600</option>
                            <option value="NVIDIA RTX 3070 / RX 6800">RTX 3070+ / High End</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Game & Mod Selection -->
            <div class="pixel-box p-6 relative mt-4">
                <div class="absolute -top-4 left-4 bg-white px-2 border-2 border-gray-800 text-xl font-bold">TARGET</div>
                
                <div class="flex flex-col gap-4 mt-2">
                    <div>
                        <label class="text-xl mb-1">Game Title</label>
                        <input type="text" id="gameInput" list="gamesList" placeholder="e.g. Hogwarts Legacy" class="pixel-input p-2 w-full">
                        <datalist id="gamesList">
                            <option value="Hogwarts Legacy">
                            <option value="Minecraft">
                            <option value="Cyberpunk 2077">
                            <option value="Elden Ring">
                            <option value="GTA V">
                            <option value="Black Myth: Wukong">
                            <option value="Red Dead Redemption 2">
                            <option value="The Witcher 3">
                            <option value="Valorant">
                        </datalist>
                    </div>

                    <div class="border-t-2 border-dashed border-gray-300 pt-4 mt-2">
                        <div class="flex items-center gap-2 mb-2">
                            <input type="checkbox" id="modCheck" onchange="toggleMods()" class="w-6 h-6 border-2 border-gray-800 rounded-none accent-[#70AA5D]">
                            <label for="modCheck" class="text-xl cursor-pointer">I want to run Mods/Shaders too</label>
                        </div>
                        
                        <div id="modInputArea" class="hidden pl-8 transition-all duration-300">
                            <label class="text-lg block mb-1">Shader/Mod Type</label>
                            <select id="modSelect" class="pixel-input p-2 w-full bg-white text-lg">
                                <option value="Light mods (Optifine, Vanilla+, simple ReShade)">Light (Optifine, Vanilla+, Reshade)</option>
                                <option value="Medium mods (BSL Shaders, HD Textures, 50+ mods)">Medium (BSL Shaders, HD Textures)</option>
                                <option value="Heavy mods (Seus PTGI, Ray Tracing, 200+ mods)">Heavy (Ray Tracing, 4K Packs, Heavy Scripts)</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <button onclick="analyzeSpecs()" id="analyzeBtn" class="pixel-btn primary py-4 text-2xl tracking-widest hover:scale-[1.01] active:scale-[0.99] flex justify-center items-center gap-2">
                <span>ANALYZE PERFORMANCE</span>
            </button>

        </section>

        <!-- Results Section -->
        <section class="lg:col-span-1 h-full">
            <div id="resultCard" class="pixel-box h-full min-h-[400px] p-6 flex flex-col relative transition-all duration-300">
                
                <!-- Initial State -->
                <div id="initialState" class="absolute inset-0 flex flex-col justify-center items-center text-center p-6 opacity-50">
                    <svg class="w-20 h-20 mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path></svg>
                    <p class="text-2xl">AWAITING INPUT DATA...</p>
                </div>

                <!-- Loading State -->
                <div id="loadingState" class="hidden absolute inset-0 flex flex-col justify-center items-center bg-white z-10">
                    <div class="w-full h-full absolute inset-0 scanning opacity-50"></div>
                    <p class="text-2xl animate-pulse font-bold relative z-20 bg-white px-2">CONTACTING AI...</p>
                    <p class="text-lg text-gray-500 relative z-20 bg-white px-2">Comparing with real-world reports</p>
                </div>

                <!-- Results Content (Hidden by default) -->
                <div id="resultContent" class="hidden flex-col h-full relative z-0">
                    <div id="verdictBadge" class="text-center py-2 text-white font-bold text-3xl mb-4 border-2 border-[#3d3d3d] shadow-[4px_4px_0px_rgba(0,0,0,0.2)]">
                        PLAYABLE
                    </div>

                    <div class="flex-grow overflow-y-auto pr-2">
                        <div class="mb-4">
                            <h3 class="text-gray-500 text-lg border-b-2 border-gray-200 mb-1">FPS ESTIMATE</h3>
                            <p id="fpsText" class="text-2xl font-bold">45-60 FPS @ 720p</p>
                        </div>

                        <div class="mb-4">
                            <h3 class="text-gray-500 text-lg border-b-2 border-gray-200 mb-1">AI ANALYSIS</h3>
                            <div id="aiExplanation" class="prose text-lg leading-tight">
                                <!-- AI text goes here -->
                            </div>
                        </div>

                        <div id="shaderSection" class="mb-4 hidden">
                            <h3 class="text-gray-500 text-lg border-b-2 border-gray-200 mb-1">MODDING VERDICT</h3>
                            <p id="shaderText" class="text-lg text-[#70AA5D]">
                                <!-- Shader text goes here -->
                            </p>
                        </div>
                    </div>
                    
                    <div class="mt-4 pt-4 border-t-2 border-dashed border-gray-300 text-center">
                        <p class="text-xs text-gray-400">Powered by Gemini AI • Estimates based on hardware similarity</p>
                    </div>
                </div>

            </div>
        </section>
    </main>

    <script>
        // API Key Management
        let GEMINI_API_KEY = localStorage.getItem('gemini_api_key') || '';

        function openModal() {
            document.getElementById('apiKeyModal').classList.remove('hidden');
            document.getElementById('apiKeyInput').value = GEMINI_API_KEY;
        }

        function closeModal() {
            document.getElementById('apiKeyModal').classList.add('hidden');
        }

        function saveKey() {
            const key = document.getElementById('apiKeyInput').value.trim();
            if (key) {
                GEMINI_API_KEY = key;
                localStorage.setItem('gemini_api_key', key);
                closeModal();
                alert('Key Saved! You can now analyze.');
            } else {
                alert('Please enter a valid key.');
            }
        }

        function toggleMods() {
            const isChecked = document.getElementById('modCheck').checked;
            const area = document.getElementById('modInputArea');
            if(isChecked) {
                area.classList.remove('hidden');
            } else {
                area.classList.add('hidden');
            }
        }

        async function analyzeSpecs() {
            const game = document.getElementById('gameInput').value;
            if (!game) {
                alert("Please enter a game name!");
                return;
            }

            if (!GEMINI_API_KEY) {
                // If no key, show modal and return
                // OR run a demo mode if you prefer, but "integrate AI" implies real AI.
                // Let's prompt for the key.
                const userWantsDemo = confirm("No Gemini API Key found. Would you like to set one up? (Cancel to see a Demo simulation instead)");
                if (userWantsDemo) {
                    openModal();
                    return;
                } else {
                    // DEMO MODE for users checking out the UI
                    runSimulation(); 
                    return;
                }
            }

            // UI Loading State
            document.getElementById('initialState').classList.add('hidden');
            document.getElementById('resultContent').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('analyzeBtn').disabled = true;
            document.getElementById('analyzeBtn').innerText = "CALCULATING...";

            // Gather Data
            const cpu = document.getElementById('cpuSelect').value;
            const gpu = document.getElementById('gpuSelect').value;
            const ram = document.getElementById('ramSelect').value;
            const modsEnabled = document.getElementById('modCheck').checked;
            const modLevel = modsEnabled ? document.getElementById('modSelect').value : "No Mods";

            // Construct Prompt
            const prompt = `
                Act as a PC Gaming Hardware Expert who understands "low-end gaming" culture (LowSpecGamer, scaling, FSR, 720p gaming).
                
                User's Rig:
                - CPU: ${cpu}
                - GPU: ${gpu}
                - RAM: ${ram}
                
                Target Game: "${game}"
                Modding Intent: ${modLevel}

                Task: Analyze if this rig can run the game. Be realistic but generous—if it runs at 30FPS on 720p Low with FSR, say it's Playable. Don't just quote official minimum specs, use knowledge of integrated graphics performance.
                
                Respond in strictly valid JSON format like this:
                {
                    "verdict": "PLAYABLE" or "STRUGGLING" or "UNPLAYABLE",
                    "verdict_color": "green" or "orange" or "red",
                    "fps_estimate": "Short string (e.g. '30-45 FPS @ 720p Low')",
                    "explanation": "2-3 sentences max. Mention specific settings (like 'Turn shadows to low', 'Use FSR Performance'). Explain WHY it runs or doesn't.",
                    "mod_verdict": "Short sentence about if the requested mods will work."
                }
            `;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${GEMINI_API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }]
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }

                const aiText = data.candidates[0].content.parts[0].text;
                // Clean markdown code blocks if present
                const jsonStr = aiText.replace(/```json/g, '').replace(/```/g, '').trim();
                const result = JSON.parse(jsonStr);

                updateUI(result);

            } catch (error) {
                console.error(error);
                alert("AI Error: " + error.message);
                resetUI();
            }
        }

        function runSimulation() {
            // Fake delay for demo purposes
            document.getElementById('initialState').classList.add('hidden');
            document.getElementById('resultContent').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
            
            setTimeout(() => {
                const demoResult = {
                    verdict: "DEMO MODE",
                    verdict_color: "orange",
                    fps_estimate: "~30 FPS (Estimated)",
                    explanation: "This is a demo result because no API Key was provided. Real AI would tell you about FSR settings and specific bottlenecks for your hardware.",
                    mod_verdict: "Mod performance cannot be calculated in demo mode."
                };
                updateUI(demoResult);
            }, 2000);
        }

        function updateUI(data) {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('resultContent').classList.remove('hidden');
            document.getElementById('resultContent').classList.add('flex');
            
            // Verdict Badge
            const badge = document.getElementById('verdictBadge');
            badge.innerText = data.verdict;
            
            if (data.verdict_color === 'green') {
                badge.style.backgroundColor = '#70AA5D';
                badge.style.borderColor = '#3d3d3d';
            } else if (data.verdict_color === 'red') {
                badge.style.backgroundColor = '#C44E4E';
                badge.style.borderColor = '#3d3d3d';
            } else {
                badge.style.backgroundColor = '#E5AA70'; // Orange
                badge.style.borderColor = '#3d3d3d';
            }

            // Details
            document.getElementById('fpsText').innerText = data.fps_estimate;
            document.getElementById('aiExplanation').innerHTML = marked.parse(data.explanation);

            // Mods
            const modSection = document.getElementById('shaderSection');
            const modText = document.getElementById('shaderText');
            if (document.getElementById('modCheck').checked || data.mod_verdict) {
                modSection.classList.remove('hidden');
                modText.innerText = data.mod_verdict || "No data.";
            } else {
                modSection.classList.add('hidden');
            }

            resetButton();
        }

        function resetUI() {
            document.getElementById('loadingState').classList.add('hidden');
            document.getElementById('initialState').classList.remove('hidden');
            resetButton();
        }

        function resetButton() {
            const btn = document.getElementById('analyzeBtn');
            btn.disabled = false;
            btn.innerHTML = `<span>ANALYZE PERFORMANCE</span>`;
        }
    </script>
</body>
</html>